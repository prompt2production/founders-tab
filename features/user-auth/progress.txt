---
Story: AUTH-001 Add User and Session models to Prisma schema
Files changed: prisma/schema.prisma
Notes: Added User model with all required fields, Role enum (FOUNDER, MEMBER), and Session model with cascade delete relation to User.
---
---
Story: AUTH-002 Add Invitation and PasswordReset models to Prisma schema
Files changed: prisma/schema.prisma
Notes: Added Invitation model with InvitationStatus enum, PasswordReset model, and updated User model with relations.
---
---
Story: AUTH-003 Run database migration for auth models
Files changed: prisma/migrations/20260113211827_add_auth_models/migration.sql
Notes: Migration applied successfully to PostgreSQL database.
---
---
Story: AUTH-004 Create auth validation schemas
Files changed: src/lib/validations/auth.ts
Notes: Created all auth schemas: signup, login, forgotPassword, resetPassword, changePassword, updateProfile with proper Zod validation.
---
---
Story: AUTH-005 Create auth validation unit tests
Files changed: tests/unit/validations/auth.test.ts
Notes: Created 18 tests covering signup, login, forgotPassword, resetPassword schemas. All tests pass.
---
---
Story: AUTH-006 Create password hashing utility
Files changed: src/lib/auth/password.ts, package.json
Notes: Installed bcryptjs, created hashPassword and verifyPassword async functions with cost factor 12.
---
---
Story: AUTH-007 Create session management utility
Files changed: src/lib/auth/session.ts
Notes: Created generateSessionToken, createSession (7-day expiry), validateSession (with user data), deleteSession, deleteAllUserSessions functions.
---
---
Story: AUTH-008 Create auth cookie utilities
Files changed: src/lib/auth/cookies.ts
Notes: Created setSessionCookie, getSessionCookie, clearSessionCookie using Next.js cookies() with 'session_token' name, HttpOnly, Secure (prod), SameSite=Lax.
---
---
Story: AUTH-009 Create getCurrentUser helper
Files changed: src/lib/auth/getCurrentUser.ts, src/lib/auth/index.ts
Notes: Created getCurrentUser function that reads session cookie and validates, returns user without passwordHash. Added barrel export in index.ts.
---
---
Story: AUTH-010 Create signup API route
Files changed: src/app/api/auth/signup/route.ts
Notes: Implemented POST handler with validation, duplicate email check, first user FOUNDER role, password hashing, avatar initials generation, session creation.
---
---
Story: AUTH-011 Create login API route
Files changed: src/app/api/auth/login/route.ts
Notes: Implemented POST handler with validation, generic error messages for security, password verification, session creation.
---
---
Story: AUTH-012 Create logout API route
Files changed: src/app/api/auth/logout/route.ts
Notes: Implemented POST handler that deletes session, clears cookie, handles missing session gracefully.
---
---
Story: AUTH-013 Create me API route
Files changed: src/app/api/auth/me/route.ts
Notes: Implemented GET handler that returns current user (without passwordHash) or 401 if not authenticated.
---
---
Story: AUTH-014 Create profile update API route
Files changed: src/app/api/users/me/route.ts
Notes: Implemented GET and PATCH handlers for user profile. PATCH validates and updates name/avatarInitials.
---
---
Story: AUTH-015 Create change password API route
Files changed: src/app/api/users/me/change-password/route.ts
Notes: Implemented POST handler with current password verification, validation, and password hash update.
---
---
Story: AUTH-016 Create team list API route
Files changed: src/app/api/team/route.ts
Notes: Implemented GET handler that returns all team members (sorted by role, then createdAt) without passwordHash.
---
---
Story: AUTH-017 Create invitation validation schemas
Files changed: src/lib/validations/invitation.ts
Notes: Created createInvitationSchema (email, optional message) and acceptInvitationSchema (token, name, password with confirmation).
---
---
Story: AUTH-018 Create send invitation API route
Files changed: src/app/api/invitations/route.ts
Notes: Implemented GET handler (returns invitations by current user) and POST handler (creates invitation with 7-day expiry, FOUNDER-only, validates email not already member).
---
---
Story: AUTH-019 Create cancel invitation API route
Files changed: src/app/api/invitations/[id]/route.ts
Notes: Implemented DELETE handler with auth check, FOUNDER-only check, 404 for missing invitation, deletes and returns 200 on success.
---
---
Story: AUTH-020 Create accept invitation API routes
Files changed: src/app/api/invitations/accept/[token]/route.ts
Notes: GET returns invitation details (email, inviter name, message) if valid. POST creates user with MEMBER role, marks invitation ACCEPTED, creates session and sets cookie.
---
---
Story: AUTH-021 Create AuthProvider context
Files changed: src/components/auth/auth-provider.tsx
Notes: Created AuthContext with user state, isLoading, isAuthenticated. Provides login, logout, refreshUser functions. Fetches user on mount from /api/auth/me.
---
---
Story: AUTH-022 Create useAuth hook
Files changed: src/hooks/useAuth.ts
Notes: Created simple wrapper hook that calls useAuthContext and returns all auth state and functions. Throws error if used outside AuthProvider via useAuthContext.
---
---
Story: AUTH-023 Create AuthGuard component
Files changed: src/components/auth/auth-guard.tsx
Notes: Shows Loader2 spinner while checking auth, redirects to /login if not authenticated, renders children if authenticated. Uses useAuth hook.
---
---
Story: AUTH-024 Create UserAvatar component
Files changed: src/components/auth/user-avatar.tsx
Notes: Accepts name or initials prop, generates consistent gradient from hash of name, supports sm/md/lg/xl sizes. Uses warm gradient colours matching brand.
---
---
Story: AUTH-025 Create LoginForm component
Files changed: src/components/auth/login-form.tsx, src/components/ui/form.tsx (added via shadcn)
Notes: Uses react-hook-form with zodResolver, email/password fields per DESIGN_SYSTEM.md, shows validation errors, loading state, error toasts via sonner.
---
---
Story: AUTH-026 Create SignupForm component
Files changed: src/components/auth/signup-form.tsx
Notes: Uses react-hook-form with zodResolver, name/email/password/confirmPassword fields, password strength indicator with check/x icons, loading state, success toast and redirect.
---
---
Story: AUTH-027 Create login page
Files changed: src/app/(auth)/login/page.tsx
Notes: Mobile-first layout, gradient app name at top, LoginForm, links to /signup and /forgot-password, redirects to / if authenticated.
---
