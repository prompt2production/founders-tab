---
Story: NOTIF-001 Add rejection statuses to database schema
Files changed: prisma/schema.prisma, prisma/migrations/20260128185536_add_rejection_statuses/migration.sql
Notes: Added REJECTED and WITHDRAWAL_REJECTED to ExpenseStatus enum. Added rejectedById, rejectedAt, rejectionReason fields to Expense model with User relation. Had to kill dev server (port 3000) to unlock prisma client DLL for generation.
---
---
Story: NOTIF-002 Create rejection validation schemas
Files changed: src/lib/validations/expense.ts, tests/unit/validations/expense-rejection.test.ts
Notes: Added rejectExpenseSchema with trim-first-then-validate pattern using z.pipe(). Added REJECTED and WITHDRAWAL_REJECTED to ExpenseStatus constant. 9 new tests all passing.
---
---
Story: NOTIF-003 Create expense rejection API route
Files changed: src/app/api/expenses/[id]/reject/route.ts, tests/unit/api/reject-expense.test.ts
Notes: Created POST /api/expenses/[id]/reject route following same patterns as approve route. 7 unit tests covering auth, role, not-found, own-expense, wrong-status, missing-reason, and success cases. All 145 tests passing.
---
---
Story: NOTIF-004 Create withdrawal rejection API route
Files changed: src/app/api/expenses/[id]/reject-withdrawal/route.ts, tests/unit/api/reject-withdrawal.test.ts
Notes: Created POST /api/expenses/[id]/reject-withdrawal route. Uses WITHDRAWAL_REJECTED status. 7 unit tests. All 152 tests passing.
---
---
Story: NOTIF-005 Create shared email notification layout helper
Files changed: src/lib/email.ts, tests/unit/lib/email-templates.test.ts
Notes: Added buildNotificationEmail, formatExpenseDetailsHtml, formatExpenseDetailsText functions. 13 unit tests. All 165 tests passing.
---
---
Story: NOTIF-006 Send notification on new expense submission
Files changed: src/lib/email.ts, src/app/api/expenses/route.ts
Notes: Added sendExpenseAwaitingApprovalEmail function plus all 5 notification email functions (006-010) in email.ts. Integrated fire-and-forget email sending in POST /api/expenses when status is PENDING_APPROVAL. All 165 tests passing.
---
---
Story: NOTIF-007 Send notification on expense approval
Files changed: src/app/api/expenses/[id]/approve/route.ts
Notes: Integrated sendExpenseApprovedEmail in approve route. Fires when isFullyApproved is true. Added email to user select. All 165 tests passing.
---
---
Story: NOTIF-008 Send notification on expense rejection
Files changed: src/app/api/expenses/[id]/reject/route.ts, tests/unit/api/reject-expense.test.ts
Notes: Integrated sendExpenseRejectedEmail in reject route. Added email to user select.
---
---
Story: NOTIF-009 Send notification on withdrawal approval
Files changed: src/app/api/expenses/[id]/approve-withdrawal/route.ts
Notes: Integrated sendWithdrawalApprovedEmail in approve-withdrawal route. Fires when isFullyApproved.
---
---
Story: NOTIF-010 Send notification on withdrawal rejection
Files changed: src/app/api/expenses/[id]/reject-withdrawal/route.ts, tests/unit/api/reject-withdrawal.test.ts
Notes: Integrated sendWithdrawalRejectedEmail in reject-withdrawal route. All 165 tests passing.
---
---
Story: NOTIF-011 Update ApprovalStatusBadge for rejected statuses
Files changed: src/components/expenses/approval-status-badge.tsx
Notes: Added REJECTED and WITHDRAWAL_REJECTED status handling with red destructive badge styling using XCircle icon. Uses danger semantic colors from DESIGN_SYSTEM.md.
---
---
Story: NOTIF-012 Create RejectExpenseButton component
Files changed: src/components/expenses/reject-expense-button.tsx, src/components/expenses/edit-expense-sheet.tsx
Notes: Created RejectExpenseButton with AlertDialog + Textarea for reason input. Calls POST /api/expenses/{id}/reject. Integrated into EditExpenseSheet next to ApproveButton. Updated Expense status type to include REJECTED and WITHDRAWAL_REJECTED. All 165 tests passing.
---